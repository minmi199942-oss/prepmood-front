# 관리자 페이지 UI 구조 검토 (Size/Color 반영)

## 📋 검토 개요

이전 대화에서 논의되었던 "관리자 페이지 전체 구조"를 **size/color 변경사항을 고려하여** 검토한 결과입니다.

---

## ✅ 대원칙: **완전히 옳고 필수적임**

### 4개 관점 분리 (절대 규칙)
1. **재고 관리 = 창고 관점** ✅
2. **주문 관리 = 출고·배송 관점** ✅
3. **보증서/토큰 = 권리 관점** ✅
4. **정정/운영 = 감사·복구 관점** ✅

**핵심 원칙**: **"4개가 섞이면 반드시 사고 난다"** - 이 원칙은 절대적으로 옳습니다.

---

## 1️⃣ 재고 관리 UI (창고 관점) - 검토 결과

### ✅ 잘 구현된 부분

1. **출고/배송 버튼 없음** ✅
   - 현재 구현: 재고 화면에 출고/배송 버튼 없음
   - 제시된 원칙 준수: "❌ 여기서는 출고/배송 버튼이 있으면 안 됨"

2. **상태 색상 뱃지** ✅
   - 현재 구현: `in-stock` (초록), `reserved` (주황), `sold` (청록), `returned` (빨강)
   - 제시된 원칙 준수: "상태는 텍스트 + 색상 뱃지 필수"

3. **재고 상세 화면 구조** ✅
   - 현재 구현: 카드형 정보 (기본 정보 + 보증/식별 정보)
   - 제시된 원칙 준수: "이 구조 자체는 이상적임"

4. **상단 필터** ✅
   - 현재 구현: 상품 선택, 상태 필터
   - 제시된 원칙 준수: 필터 영역 존재

### ⚠️ 개선 필요: **테이블 컬럼 순서 및 내용**

#### 제시된 권장 순서:
1. 재고 ID ✅
2. 상품명 ✅
3. 내부 코드
4. 토큰 (짧게 표시 + 복사 버튼)
5. 상태 (색상 뱃지) ✅
6. 예약 주문 ID ✅
7. 예약일시 ⚠️ **누락**
8. 판매일시 ⚠️ **누락**
9. 생성일 ✅
10. [상세 보기] ✅

#### 현재 구현 순서:
1. 재고 ID ✅
2. 상품명 ✅
3. **사이즈** ⚠️ **추가됨 (제시된 구조에는 없음)**
4. **색상** ⚠️ **추가됨 (제시된 구조에는 없음)**
5. 토큰 ✅
6. 내부 코드 ✅
7. **시리얼 넘버** ⚠️ **추가됨 (제시된 구조에는 없음)**
8. 상태 ✅
9. 예약 주문 ✅
10. 생성일 ✅
11. 액션 ✅

#### 분석 및 권장사항

**✅ size, color 추가는 올바름** (제시된 구조가 size/color 변경 전이므로)
- 이유: 현재 `stock_units`에 `size`, `color` 컬럼이 있고, 재고 관리 시 필수 정보임
- 제시된 구조는 size/color 도입 이전 문서이므로, **추가해야 함**

**✅ 시리얼 넘버 추가는 올바름**
- 이유: 창고 관점에서 "실물 식별"이 중요함
- 내부 코드와는 다른 물리적 식별자

**⚠️ 컬럼 순서 조정 권장**:
- **권장 순서** (창고 관점 최적화):
  1. 재고 ID
  2. 상품명
  3. **사이즈** (물리적 특성)
  4. **색상** (물리적 특성)
  5. 내부 코드
  6. 토큰 (짧게 표시 + 복사 버튼)
  7. 시리얼 넘버
  8. 상태 (색상 뱃지)
  9. 예약 주문 ID
  10. 예약일시 ⚠️ **추가 필요**
  11. 판매일시 ⚠️ **추가 필요**
  12. 생성일
  13. [상세 보기]

**⚠️ 누락된 컬럼 추가 필요**:
- `reserved_at` (예약일시)
- `sold_at` (판매일시)
- 토큰 복사 버튼 (UX 개선)

**📊 백엔드 API 확인 필요**:
- 현재 `GET /api/admin/stock`에서 `reserved_at`, `sold_at` 반환하는지 확인
- 반환하지 않으면 백엔드 API 수정 필요

---

## 2️⃣ 주문 관리 UI (출고·배송 관점) - 검토 결과

### ❌ **심각한 문제: 핵심 기능 누락**

#### 제시된 구조 요구사항:
- 주문 상세 화면에 **"출고/배송 유닛 테이블 (order_item_units)"** ⭐⭐⭐ **필수**
- 테이블 컬럼:
  - 체크박스
  - 유닛 ID
  - 상품명
  - 내부 코드 / 토큰
  - **사이즈** (제시된 구조에는 없지만, size/color 도입 후 추가 필요)
  - **색상** (제시된 구조에는 없지만, size/color 도입 후 추가 필요)
  - 상태 (`reserved` / `shipped` / `delivered`)
  - 택배사
  - 송장번호
  - 출고일
  - 배송완료일
- 액션 버튼:
  - **출고 처리 버튼** (reserved 상태만 선택 가능)
  - **배송완료 처리 버튼** (shipped 상태만 선택 가능)

#### 현재 구현 상태:
- ❌ **order_item_units 테이블 없음**
- ❌ **shipped/delivered 버튼 없음**
- ✅ order_items만 표시 (상품명, 옵션, 수량, 가격)
- ✅ 백엔드 API는 이미 구현됨:
  - `POST /api/admin/orders/:orderId/shipped` ✅
  - `POST /api/admin/orders/:orderId/delivered` ✅

#### 분석:
**제시된 구조가 절대적으로 옳습니다.** 이유:
1. **물류 관점**: 주문 단위(`order_items`)가 아니라 **물리 유닛 단위(`order_item_units`)**로 출고/배송해야 함
2. **부분 출고/배송**: 일부만 출고하는 경우를 자연스럽게 지원
3. **추적 가능**: 각 유닛별로 택배사/송장번호/일시를 관리

**현재 구현은 "주문 상품 리스트"만 보여주고, 실제 출고/배송 기능이 없음** → **반드시 개선 필요**

### 📝 권장 구현 방안

**주문 상세 화면 구조 (제시된 구조 + size/color 반영)**:

```
A. 주문 요약 카드 (현재 있음)
   - 주문 ID, 결제 상태, 주문자 정보, 주소, 결제 시각

B. 상품 라인 (order_items) (현재 있음)
   - 상품명, 사이즈, 색상, 수량
   - ❌ 여기서는 출고 버튼 없음

C. 출고/배송 유닛 테이블 (order_item_units) ⭐⭐⭐ **필수 추가**
   컬럼:
   - [체크박스]
   - 유닛 ID
   - 상품명
   - 사이즈 (size/color 도입 후 추가)
   - 색상 (size/color 도입 후 추가)
   - 내부 코드
   - 토큰 (짧게)
   - 상태 (reserved/shipped/delivered) [색상 뱃지]
   - 택배사
   - 송장번호 (클릭 시 추적 링크)
   - 출고일
   - 배송완료일

D. 액션 영역
   - [출고 처리] 버튼 (reserved 상태만 선택 가능)
     - 클릭 시 모달: 택배사 선택, 송장번호 입력
     - 확인 → POST /api/admin/orders/:orderId/shipped
   
   - [배송완료 처리] 버튼 (shipped 상태만 선택 가능)
     - 확인 → POST /api/admin/orders/:orderId/delivered
```

**백엔드 API 확인**:
- `GET /api/admin/orders/:orderId`에서 `order_item_units` 정보를 반환하는지 확인 필요
- 현재는 `order_items`만 반환하는 것으로 보임 → **백엔드 API 수정 필요**

---

## 3️⃣ 보증서/토큰 관리 UI (권리 관점) - 검토 결과

### 현재 상태
- ❌ 별도 화면이 구현되어 있지 않은 것으로 보임
- 제시된 구조는 향후 구현 계획으로 보임

### 제시된 구조 검토
- ✅ **옳음**: 토큰 검색 화면, 토큰 상세 화면 구조가 적절함
- ✅ **SSOT 준수**: `token_master` 중심 구조는 올바름

---

## 4️⃣ 정정/운영 UI (감사 관점) - 검토 결과

### 현재 상태
- ❌ 별도 화면이 구현되어 있지 않은 것으로 보임
- 제시된 구조는 향후 구현 계획으로 보임

### 제시된 구조 검토
- ✅ **옳음**: 슈퍼 관리자 전용, 정정 이력 추적 구조가 적절함
- ✅ **`ADMIN_PAGE_OPERATIONAL_REVIEW.md`와 일치**: 재고 정정 안전장치 등 이미 논의됨

---

## 📊 전체 평가

### ✅ 잘 구현된 부분 (재고 관리)

1. **대원칙 준수** ✅
   - 재고 화면에 출고/배송 버튼 없음
   - 상태 색상 뱃지 적용
   - 재고 상세 화면 구조 적절

2. **Size/Color 도입 적절** ✅
   - 재고 테이블에 size, color 컬럼 추가
   - 재고 추가 모달에 size, color 입력 필드 추가
   - 재고 상세 모달에 size, color 표시

3. **컬럼 순서는 조정 가능** ⚠️
   - 제시된 권장 순서와 다르지만, size/color 도입 후에는 현재 순서도 합리적
   - 단, `reserved_at`, `sold_at` 컬럼 추가 권장

### ❌ **심각한 문제: 주문 관리 UI**

1. **order_item_units 테이블 없음** ❌
   - 제시된 구조에서 **"이 화면이 관리자 UX의 핵심"**이라고 강조했지만 미구현
   - **반드시 구현 필요**

2. **shipped/delivered 버튼 없음** ❌
   - 백엔드 API는 이미 구현되어 있지만 프론트엔드 미구현
   - **반드시 구현 필요**

3. **물류 상태 집계 없음** ⚠️
   - 제시된 구조: "물류 상태(집계): 출고대기, 부분출고, 출고완료, 부분배송완료, 배송완료"
   - 현재 구현: `orders.status`만 표시 (ENUM 기반)
   - `order_item_units` 기반 집계 필요

---

## 🔧 권장 개선 사항 (우선순위)

### 1. **최우선: 주문 관리 UI 개선** (출고·배송 관점)

#### 1-1. 백엔드 API 수정
- `GET /api/admin/orders/:orderId`에서 `order_item_units` 정보 반환 추가
- 필요한 정보:
  ```javascript
  {
    order_item_units: [
      {
        order_item_unit_id: number,
        order_item_id: number,
        unit_seq: number,
        stock_unit_id: number,
        token_pk: number,
        unit_status: 'reserved' | 'shipped' | 'delivered' | 'refunded',
        carrier_code: string | null,
        tracking_number: string | null,
        shipped_at: datetime | null,
        delivered_at: datetime | null,
        // 연결된 stock_units 정보
        internal_code: string | null,
        token: string,
        // 연결된 order_items 정보 (size/color 포함)
        product_name: string,
        size: string | null,
        color: string | null
      }
    ]
  }
  ```

#### 1-2. 프론트엔드 UI 추가
- 주문 상세 화면에 "출고/배송 유닛 테이블" 추가
- 체크박스, 상태별 색상 뱃지, 출고/배송 버튼 추가

### 2. **중요: 재고 관리 UI 개선** (컬럼 추가)

#### 2-1. 백엔드 API 확인/수정
- `GET /api/admin/stock`에서 `reserved_at`, `sold_at` 반환 확인
- 반환하지 않으면 추가

#### 2-2. 프론트엔드 UI 개선
- 테이블에 `예약일시`, `판매일시` 컬럼 추가
- 토큰 복사 버튼 추가 (UX 개선)

### 3. **선택: 필터 개선** (재고 관리)

- 제시된 구조: "토큰/내부코드 검색", "예약 주문 ID 검색"
- 현재 구현: 상품 선택, 상태 필터만 있음
- 추가 검색 기능 구현 (선택 사항)

---

## 🎯 최종 평가

### ✅ 제시된 구조의 적절성: **100% 적절함**

**이유**:
1. **대원칙 (4개 관점 분리)**는 절대적으로 옳음
2. **재고 관리 UI**는 이미 잘 구현되어 있고, size/color 도입 후 개선도 적절함
3. **주문 관리 UI**는 제시된 구조가 맞지만, 현재 미구현 상태
4. **보증서/토큰 관리**, **정정/운영** UI는 향후 구현 계획으로 적절

### ⚠️ 현재 구현의 문제점

1. **주문 관리 UI에서 order_item_units 테이블 누락** ❌
   - 제시된 구조에서 "이 화면이 관리자 UX의 핵심"이라고 강조했지만 미구현
   - **반드시 구현 필요** (최우선)

2. **shipped/delivered 기능 누락** ❌
   - 백엔드 API는 이미 구현되어 있지만 프론트엔드 미구현
   - **반드시 구현 필요** (최우선)

3. **재고 관리 테이블에 일부 컬럼 누락** ⚠️
   - `reserved_at`, `sold_at` 컬럼 추가 권장 (중요)

### 📝 Size/Color 도입 후 권장 구조

**재고 관리 테이블 컬럼 순서** (size/color 도입 반영):
1. 재고 ID
2. 상품명
3. **사이즈** (물리적 특성 - 중요)
4. **색상** (물리적 특성 - 중요)
5. 내부 코드
6. 토큰 (짧게 표시 + 복사 버튼)
7. 시리얼 넘버
8. 상태 (색상 뱃지)
9. 예약 주문 ID
10. 예약일시
11. 판매일시
12. 생성일
13. [상세 보기]

**주문 관리 (출고/배송 유닛 테이블)** 컬럼 (size/color 도입 반영):
1. [체크박스]
2. 유닛 ID
3. 상품명
4. **사이즈** (물리적 특성 - 중요)
5. **색상** (물리적 특성 - 중요)
6. 내부 코드 / 토큰
7. 상태 (reserved/shipped/delivered) [색상 뱃지]
8. 택배사
9. 송장번호 (클릭 시 추적 링크)
10. 출고일
11. 배송완료일

---

## 🚀 결론

### 제시된 구조 평가: **✅ 완전히 옳고 필수적임**

**특히**:
1. **4개 관점 분리** 원칙은 절대적으로 옳음
2. **재고 화면에서 출고/배송 버튼 없음** 원칙은 올바름 (현재 준수)
3. **주문 상세에서 order_item_units 테이블** 구조는 물류 관점에서 필수
4. **부분 출고/배송** 지원은 실제 운영에서 필수

### 현재 구현 평가: **⚠️ 부분적으로 구현됨**

**잘 구현된 부분**:
- ✅ 재고 관리 UI (대원칙 준수, size/color 도입 적절)
- ✅ 백엔드 API (shipped/delivered API 구현됨)

**개선 필요 부분**:
- ❌ **주문 관리 UI에서 order_item_units 테이블 및 shipped/delivered 버튼 구현** (최우선)
- ⚠️ 재고 관리 테이블에 `reserved_at`, `sold_at` 컬럼 추가 (중요)

### 권장 작업 순서

1. **최우선**: 주문 관리 UI에 order_item_units 테이블 및 shipped/delivered 버튼 구현
2. **중요**: 재고 관리 테이블에 `reserved_at`, `sold_at` 컬럼 추가
3. **선택**: 토큰 복사 버튼, 추가 검색 필터

---

**문서 버전**: 1.0  
**검토일**: 2026-01-11  
**검토 기준**: 제시된 구조 + Size/Color 표준화 정책 반영
