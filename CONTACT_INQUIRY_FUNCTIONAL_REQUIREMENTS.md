# 문의 관리 페이지 기능 요구사항

## 📋 핵심 요구사항

**목표: 네이버처럼 한 페이지에서 문의를 보고, 처리하고, 정리할 수 있는 기능**

**중요:**
- 모바일 대응 불필요 (관리자 페이지는 데스크톱 전용)
- 디자인/색감은 중요하지 않음 (기능 중심)
- 핵심: 한 화면에서 목록 + 상세 + 처리 동시 작업 가능

---

## 1. 핵심 기능

### 1.1 목록 보기

**한 번에 보는 칸 (테이블 컬럼):**
- 접수일시
- 처리상태 (배지로 표시)
- 문의유형(카테고리)
- 문의제목(토픽)
- 고객명 (성+이름)
- 이메일
- 접수번호 (선택)

**제외할 항목:**
- 상품번호 ❌
- 상품명 ❌
- 주문번호 ❌

**기능:**
- 행 클릭 시 하단 패널에 상세 표시 (페이지 이동 없음)
- 페이지네이션 (20개씩)

### 1.2 상세 보기

**하단 고정 패널 (2분할):**

**왼쪽: 문의 상세**
- 접수번호
- 접수일시
- 고객 정보 (이름, 이메일, 전화번호, 지역)
- 문의유형/제목
- 문의내용(원문)

**오른쪽: 처리 패널**
- 답변 입력 textarea
- "답변 전송" 버튼
- 처리상태 변경 드롭다운 + 저장
- 관리자 메모 textarea + 저장
- 답변 이력 (누가/언제/무슨 답변을 보냈는지)

**기능:**
- 목록 행 클릭 시 하단 패널 표시
- AJAX로 상세 로드 (페이지 이동 없음)
- 목록 스크롤 위치 유지

### 1.3 처리하기

**답변 전송:**
- 답변 작성 후 "답변 전송" 클릭
- 자동 처리:
  - 답변 저장 (inquiry_replies)
  - 문의 상태 answered로 자동 변경
  - 이메일 발송
  - 이메일 발송 결과 기록
- 성공 시:
  - 답변 이력 새로고침
  - 목록 새로고침 (상태 업데이트)
  - 통계 새로고침
  - 하단 패널은 그대로 유지 (페이지 이동 없음)

**상태 변경:**
- 드롭다운에서 상태 선택 (new, in_progress, answered, closed)
- "상태 변경" 버튼 클릭
- 즉시 반영 (목록 새로고침)

**메모 저장:**
- 관리자 메모 입력
- "메모 저장" 버튼 클릭
- 즉시 저장

### 1.4 정리하기

**필터/검색:**
- 조회 기간: 접수일 (From ~ To) + 빠른 선택 (오늘, 1주일, 1개월, 3개월)
- 처리상태: 전체, 신규, 처리중, 답변 완료, 종료
- 문의유형(카테고리): 전체, 8개 카테고리
- 검색: 이메일/접수번호/이름
- 검색 버튼 + 초기화 버튼

**통계 (선택):**
- 신규 문의
- 처리중
- 오늘 접수

---

## 2. 레이아웃 구조

### 2.1 전체 구조

```
┌─────────────────────────────────────┐
│ 상단 필터/검색 바                    │
├─────────────────────────────────────┤
│ 통계 카드 (선택)                     │
├─────────────────────────────────────┤
│ 목록 테이블                          │
│ (접수일시, 처리상태, 문의유형, ...)  │
├─────────────────────────────────────┤
│ 페이지네이션                         │
└─────────────────────────────────────┘
┌─────────────────────────────────────┐
│ 하단 고정 패널 (목록 클릭 시 표시)    │
│ ┌─────────────┬─────────────────┐ │
│ │ 문의 상세    │ 처리 패널        │ │
│ │ (왼쪽)       │ (오른쪽)         │ │
│ └─────────────┴─────────────────┘ │
└─────────────────────────────────────┘
```

### 2.2 하단 고정 패널

**CSS 구조:**
```css
.inquiry-detail-panel {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  height: 50vh; /* 화면 높이의 50% */
  background: white;
  border-top: 2px solid #dee2e6;
  box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
  display: grid;
  grid-template-columns: 1fr 1fr; /* 2분할 */
  gap: 1rem;
  padding: 1.5rem;
  overflow-y: auto;
  z-index: 100;
  transform: translateY(100%); /* 기본적으로 숨김 */
  transition: transform 0.3s ease;
}

.inquiry-detail-panel.show {
  transform: translateY(0); /* 표시 */
}

/* 목록 영역 조정 (패널이 열릴 때) */
.inquiry-list-container.panel-open {
  margin-bottom: 50vh; /* 패널 높이만큼 여백 */
}
```

---

## 3. 데이터 흐름

### 3.1 목록 클릭 → 상세 표시

```
1. 사용자가 목록 행 클릭
2. JavaScript: openInquiryDetail(inquiryId)
3. 하단 패널 표시 (display: block)
4. AJAX: GET /api/admin/inquiries/:id
5. 하단 패널 왼쪽에 상세 정보 채우기
6. AJAX: GET /api/admin/inquiries/:id/replies
7. 하단 패널 오른쪽에 답변 이력 표시
8. 목록 스크롤 위치 유지 (페이지 이동 없음)
```

### 3.2 답변 전송 → 자동 처리

```
1. 사용자가 답변 작성 후 "답변 전송" 클릭
2. JavaScript: sendReply()
3. AJAX: POST /api/admin/inquiries/:id/reply
4. 서버 처리:
   - 트랜잭션: 답변 저장 + 상태 answered 변경
   - 커밋
   - 이메일 발송 (트랜잭션 외부)
   - 이메일 결과 기록
5. 성공 응답
6. 프론트엔드:
   - 답변 이력 새로고침 (하단 패널 오른쪽)
   - 목록 새로고침 (상태 업데이트)
   - 통계 새로고침
   - 하단 패널은 그대로 유지
```

### 3.3 필터/검색 → 목록 갱신

```
1. 사용자가 필터/검색 조건 변경
2. JavaScript: loadInquiries()
3. AJAX: GET /api/admin/inquiries?status=...&category=...&search=...
4. 목록 테이블 새로고침
5. 하단 패널은 그대로 유지 (열려있으면)
```

---

## 4. 구현 시 핵심 포인트

### 4.1 한 페이지에서 모든 작업

**요구사항:**
- 목록 보기
- 상세 보기
- 처리하기 (답변, 상태 변경, 메모)
- 정리하기 (필터/검색)

**구현:**
- 하단 고정 패널로 상세/처리 동시 표시
- AJAX로 모든 작업 처리 (페이지 이동 없음)
- 목록 스크롤 위치 유지

### 4.2 즉시 반영

**요구사항:**
- 답변 전송 시 목록 상태 즉시 업데이트
- 상태 변경 시 목록 즉시 반영
- 필터/검색 시 목록 즉시 갱신

**구현:**
- 모든 작업 후 목록 새로고침
- 하단 패널은 그대로 유지

### 4.3 처리 속도 향상

**요구사항:**
- 목록과 상세를 동시에 볼 수 있음
- 답변 작성 중에도 목록 참조 가능
- 페이지 이동 없이 모든 작업 가능

**구현:**
- 하단 고정 패널 방식
- AJAX로 모든 작업 처리

---

## 5. 현재 구조와의 차이점

### 5.1 현재 구조 (orders.html)

- 모달 방식: 클릭 시 팝업으로 상세 표시
- 모달 닫아야 목록 다시 볼 수 있음
- 페이지 이동 없음 (AJAX 사용)

### 5.2 변경 후 구조 (inquiries.html)

- 하단 고정 패널: 클릭 시 하단에 상세 표시
- 목록과 상세를 동시에 볼 수 있음
- 페이지 이동 없음 (AJAX 사용)

**차이점:**
- 모달 → 하단 고정 패널
- 팝업 → 고정 패널
- 동시 작업 가능

---

## 6. 구현 가능성

### ✅ 완전히 가능

**현재 관리자 페이지 구조(orders.html)를 기반으로:**
- 필터/검색 바 확장: ✅ 가능
- 목록 테이블: ✅ 가능
- 하단 고정 패널: ✅ 가능 (CSS 추가)
- 2분할 레이아웃: ✅ 가능 (CSS Grid)
- AJAX 상세 로드: ✅ 가능 (현재와 동일)
- 답변 전송: ✅ 가능 (이미 계획서에 포함)

**구현 난이도:**
- 필터/검색 바: 낮음 (현재 구조 확장)
- 목록 테이블: 낮음 (현재와 동일)
- 하단 고정 패널: 중간 (CSS 추가)
- 2분할 레이아웃: 중간 (CSS Grid)
- AJAX 상세 로드: 낮음 (현재와 동일)

**전체 난이도: 중간**

---

## 7. 최종 요구사항 정리

### 7.1 필수 기능

1. ✅ **목록 보기**: 접수일시, 처리상태, 문의유형, 문의제목, 고객명, 이메일 한 번에 확인
2. ✅ **상세 보기**: 목록 클릭 시 하단 패널에 상세 정보 표시 (페이지 이동 없음)
3. ✅ **처리하기**: 하단 패널에서 답변 작성, 상태 변경, 메모 저장 즉시 처리
4. ✅ **정리하기**: 필터/검색으로 원하는 문의만 빠르게 찾기

### 7.2 레이아웃

- 상단: 필터/검색 바
- 가운데: 목록 테이블
- 하단: 고정 패널 (2분할)
  - 왼쪽: 문의 상세
  - 오른쪽: 처리 패널

### 7.3 동작 방식

- 목록 행 클릭 → 하단 패널 표시
- 하단 패널에서 모든 처리 작업
- 목록은 그대로 유지 (스크롤 위치 유지)
- 모든 작업은 AJAX로 처리 (페이지 이동 없음)

---

## ✅ 최종 결론

**네이버처럼 한 페이지에서 문의를 보고, 처리하고, 정리할 수 있는 기능 구현이 가능합니다.**

**핵심:**
- 모바일 대응 불필요 (관리자 페이지는 데스크톱 전용)
- 디자인/색감은 중요하지 않음 (기능 중심)
- 한 화면에서 목록 + 상세 + 처리 동시 작업 가능

**구현 준비 완료 상태입니다.**







