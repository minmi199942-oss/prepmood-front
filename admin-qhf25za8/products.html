<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>상품 관리 | Pre.pMood Admin</title>
  <link rel="stylesheet" href="../assets/css/global.css">
  <link rel="stylesheet" href="admin.css">
</head>
<body>
  <!-- 관리자 헤더는 admin-layout.js에서 동적 생성됨 -->

  <!-- 메인 컨텐츠 -->
  <main class="admin-main">
    <div class="admin-container">
      <!-- 상단 액션 바 -->
      <div class="admin-toolbar">
        <h2>상품 관리</h2>
        <div class="toolbar-actions">
          <input type="text" id="searchInput" placeholder="상품 검색..." class="search-input">
          <select id="categoryFilter" class="filter-select">
            <option value="">전체 카테고리</option>
            <option value="tops">상의</option>
            <option value="bottoms">하의</option>
            <option value="outer">아우터</option>
            <option value="bags">가방</option>
            <option value="accessories">액세서리</option>
          </select>
          <button id="addProductBtn" class="btn-primary">+ 새 상품 추가</button>
        </div>
      </div>

      <!-- 로딩 상태 -->
      <div class="loading-state" id="loadingState">
        <p>상품 목록을 불러오는 중...</p>
      </div>

      <!-- 상품 목록 -->
      <div class="products-grid" id="productsGrid">
        <!-- 상품 카드가 JavaScript로 동적 생성됨 -->
      </div>

      <!-- 빈 상태 -->
      <div class="empty-state" id="emptyState" style="display: none;">
        <div class="empty-icon">📦</div>
        <h3>등록된 상품이 없습니다</h3>
        <p>새 상품을 추가해보세요.</p>
        <button class="btn-primary" onclick="document.getElementById('addProductBtn').click()">+ 상품 추가</button>
      </div>
    </div>
  </main>

  <!-- 상품 추가/수정 모달 -->
  <div class="modal" id="productModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modalTitle">새 상품 추가</h3>
        <button class="modal-close" id="closeModal">&times;</button>
      </div>
      
      <form id="productForm" class="product-form">
        <!-- 상품 ID -->
        <div class="form-group">
          <label for="productId">상품 ID *</label>
          <input type="text" id="productId" name="id" placeholder="예: PM-26-SH-001" required>
          <small>형식: PM-{year}-{category}-{number} (예: PM-26-SH-001)</small>
        </div>

        <!-- 상품명 -->
        <div class="form-group">
          <label for="productName">상품명 *</label>
          <input type="text" id="productName" name="name" placeholder="상품명을 입력하세요" required>
        </div>

        <!-- 가격 -->
        <div class="form-group">
          <label for="productPrice">가격 (원) *</label>
          <input type="number" id="productPrice" name="price" placeholder="129000" required>
        </div>

        <!-- 이미지 -->
        <div class="form-group">
          <label for="productImage">상품 이미지</label>
          <div class="image-upload-area">
            <div class="image-preview" id="imagePreview">
              <img id="previewImg" src="" alt="미리보기" style="display: none;">
              <div class="upload-placeholder" id="uploadPlaceholder">
                <span>📷</span>
                <p>이미지를 업로드하세요</p>
              </div>
            </div>
            <input type="file" id="imageInput" accept="image/*" style="display: none;">
            <input type="text" id="productImage" name="image" style="display: none;">
            <button type="button" class="btn-secondary" onclick="document.getElementById('imageInput').click()">이미지 선택</button>
          </div>
        </div>

        <!-- 컬렉션 연도 -->
        <div class="form-group">
          <label for="productCollectionYear">컬렉션 연도 *</label>
          <input type="number" id="productCollectionYear" name="collection_year" 
                 value="2026" min="2000" max="2100" required>
          <small>기본값: 2026</small>
        </div>

        <!-- 카테고리 -->
        <div class="form-group">
          <label for="productCategory">카테고리 *</label>
          <select id="productCategory" name="category" required>
            <option value="">선택하세요</option>
            <option value="tops">상의 (Tops)</option>
            <option value="bottoms">하의 (Bottoms)</option>
            <option value="outer">아우터 (Outer)</option>
            <option value="bags">가방 (Bags)</option>
            <option value="accessories">액세서리 (Accessories)</option>
          </select>
        </div>

        <!-- 타입 (액세서리일 때만 표시) -->
        <div class="form-group" id="productTypeGroup" style="display: none;">
          <label for="productType">타입 <span style="color: red;">*</span></label>
          <select id="productType" name="type">
            <option value="">선택하세요</option>
            <option value="cap">모자</option>
            <option value="wallet">지갑</option>
            <option value="tie">넥타이</option>
            <option value="scarf">목도리</option>
            <option value="belt">벨트</option>
          </select>
          <small>액세서리 카테고리일 때만 필수</small>
        </div>

        <!-- 설명 -->
        <div class="form-group">
          <label for="productDescription">상품 설명</label>
          <textarea id="productDescription" name="description" rows="4" placeholder="상품 설명을 입력하세요 (선택사항)"></textarea>
        </div>

        <!-- 버튼 -->
        <div class="form-actions">
          <button type="button" class="btn-secondary" id="cancelBtn">취소</button>
          <button type="submit" class="btn-primary" id="submitBtn">저장</button>
        </div>
      </form>
    </div>
  </div>

  <!-- 옵션 추가 모달 (색상/사이즈: 드롭다운 추천 + 직접 입력) -->
  <div class="modal" id="addOptionModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>옵션 추가</h3>
        <button type="button" class="modal-close" id="addOptionModalClose">&times;</button>
      </div>
      <div class="modal-body">
        <p style="color:#666; font-size:0.875rem; margin-bottom:1rem;">목록에서 선택하거나 새 값(예: Red)을 직접 입력해 등록할 수 있습니다. 색상은 띄어쓰기·대소문자를 정확히 맞추세요. (예: Light Blue)</p>
        <div class="form-group">
          <label for="addOptionColor">색상</label>
          <input type="text" id="addOptionColor" list="addOptionColorList" placeholder="선택 또는 직접 입력 (예: Black, Light Blue)" autocomplete="off" style="width:100%;">
          <datalist id="addOptionColorList"></datalist>
        </div>
        <div class="form-group">
          <label for="addOptionSize">사이즈</label>
          <input type="text" id="addOptionSize" list="addOptionSizeList" placeholder="선택 또는 직접 입력 (예: S, M, L, F)" autocomplete="off" style="width:100%;">
          <datalist id="addOptionSizeList"></datalist>
        </div>
        <div class="form-actions" style="margin-top:1rem;">
          <button type="button" class="btn-secondary" id="addOptionCancelBtn">취소</button>
          <button type="button" class="btn-primary" id="addOptionSubmitBtn">추가</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 공통 레이아웃 스크립트 (헤더/네비게이션) -->
  <script src="admin-layout.js"></script>
  <!-- 페이지별 스크립트 -->
  <script src="admin-products.js"></script>
  <script>
    // 공통 레이아웃 초기화 (권한 체크 + 헤더 렌더링)
    document.addEventListener('DOMContentLoaded', async () => {
      const ok = await initAdminLayout('products');
      if (!ok) return;
      
      // 네임스페이스 패턴으로 페이지별 init 호출
      const fn = window.AdminPages?.products?.init;
      if (typeof fn === 'function') fn();
    });
  </script>
</body>
</html>

