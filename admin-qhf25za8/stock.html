<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ì¬ê³  ê´€ë¦¬ | Pre.pMood Admin</title>
  <link rel="stylesheet" href="../assets/css/global.css">
  <link rel="stylesheet" href="admin.css">
  <style>
    /* ì¬ê³  ê´€ë¦¬ ì „ìš© ìŠ¤íƒ€ì¼ */
    .stats-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .stat-card {
      background: #f8f9fa;
      padding: 1.5rem;
      border-radius: 8px;
      border: 1px solid #e9ecef;
    }

    .stat-label {
      font-size: 0.875rem;
      color: #6c757d;
      margin-bottom: 0.5rem;
    }

    .stat-value {
      font-size: 1.75rem;
      font-weight: 600;
      color: #212529;
    }

    .stock-table-container {
      overflow-x: auto;
      background: white;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .stock-table {
      width: 100%;
      border-collapse: collapse;
    }

    .stock-table thead {
      background: #f8f9fa;
      border-bottom: 2px solid #dee2e6;
    }

    .stock-table th {
      padding: 1rem;
      text-align: left;
      font-weight: 600;
      font-size: 0.875rem;
      color: #495057;
    }

    .stock-table td {
      padding: 1rem;
      border-bottom: 1px solid #dee2e6;
      font-size: 0.875rem;
    }

    .stock-table tbody tr:hover {
      background: #f8f9fa;
    }

    .badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      font-size: 0.75rem;
      font-weight: 600;
      border-radius: 12px;
      text-transform: uppercase;
    }

    .badge.in-stock {
      background: #d4edda;
      color: #155724;
    }

    .badge.reserved {
      background: #fff3cd;
      color: #856404;
    }

    .badge.sold {
      background: #d1ecf1;
      color: #0c5460;
    }

    .badge.returned {
      background: #f8d7da;
      color: #721c24;
    }

    .token-masked {
      font-family: monospace;
      font-size: 0.875rem;
    }

    .modal-content {
      max-width: 600px;
    }

    .token-list {
      max-height: 300px;
      overflow-y: auto;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      padding: 0.5rem;
      margin-top: 0.5rem;
    }

    .token-item {
      display: flex;
      align-items: center;
      padding: 0.5rem;
      border-bottom: 1px solid #f0f0f0;
    }

    .token-item:last-child {
      border-bottom: none;
    }

    .token-item input[type="checkbox"] {
      margin-right: 0.5rem;
    }

    .token-info {
      flex: 1;
      font-family: monospace;
      font-size: 0.875rem;
    }
  </style>
</head>
<body>
  <!-- ê´€ë¦¬ì í—¤ë”ëŠ” admin-layout.jsì—ì„œ ë™ì  ìƒì„±ë¨ -->

  <!-- ë©”ì¸ ì»¨í…ì¸  -->
  <main class="admin-main">
    <div class="admin-container">
      <!-- ìƒë‹¨ ì•¡ì…˜ ë°” -->
      <div class="admin-toolbar">
        <h2>ì¬ê³  ê´€ë¦¬</h2>
        <div class="toolbar-actions">
          <select id="productFilter" class="filter-select">
            <option value="">ì „ì²´ ìƒí’ˆ</option>
          </select>
          <select id="statusFilter" class="filter-select">
            <option value="">ì „ì²´ ìƒíƒœ</option>
            <option value="in_stock">ì¬ê³  ìˆìŒ</option>
            <option value="reserved">ì˜ˆì•½ë¨</option>
            <option value="sold">íŒë§¤ë¨</option>
            <option value="returned">ë°˜í’ˆë¨</option>
          </select>
          <button id="addStockBtn" class="btn-primary">+ ì¬ê³  ì¶”ê°€</button>
        </div>
      </div>

      <!-- í†µê³„ ì¹´ë“œ -->
      <div class="stats-cards" id="statsCards">
        <div class="stat-card">
          <div class="stat-label">ì „ì²´ ì¬ê³ </div>
          <div class="stat-value" id="totalStock">-</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">ì¬ê³  ìˆìŒ</div>
          <div class="stat-value" id="inStockCount">-</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">ì˜ˆì•½ë¨</div>
          <div class="stat-value warning" id="reservedCount">-</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">íŒë§¤ë¨</div>
          <div class="stat-value" id="soldCount">-</div>
        </div>
      </div>

      <!-- ë¡œë”© ìƒíƒœ -->
      <div class="loading-state" id="loadingState">
        <p>ì¬ê³  ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
      </div>

      <!-- ì¬ê³  ëª©ë¡ -->
      <div class="stock-table-container" id="stockTableContainer" style="display: none;">
        <table class="stock-table">
          <thead>
            <tr>
              <th>ì¬ê³  ID</th>
              <th>ìƒí’ˆëª…</th>
              <th>ì‚¬ì´ì¦ˆ</th>
              <th>ìƒ‰ìƒ</th>
              <th>í† í°</th>
              <th>ë‚´ë¶€ ì½”ë“œ</th>
              <th>ì‹œë¦¬ì–¼ ë„˜ë²„</th>
              <th>ìƒíƒœ</th>
              <th>ì˜ˆì•½ ì£¼ë¬¸</th>
              <th>ì˜ˆì•½ì¼ì‹œ</th>
              <th>íŒë§¤ì¼ì‹œ</th>
              <th>ìƒì„±ì¼</th>
              <th>ì•¡ì…˜</th>
            </tr>
          </thead>
          <tbody id="stockTableBody">
            <!-- ì¬ê³  ëª©ë¡ì´ JavaScriptë¡œ ë™ì  ìƒì„±ë¨ -->
          </tbody>
        </table>
      </div>

      <!-- ë¹ˆ ìƒíƒœ -->
      <div class="empty-state" id="emptyState" style="display: none;">
        <div class="empty-icon">ğŸ“¦</div>
        <h3>ë“±ë¡ëœ ì¬ê³ ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
        <p>ìƒˆ ì¬ê³ ë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”.</p>
        <button class="btn-primary" onclick="document.getElementById('addStockBtn').click()">+ ì¬ê³  ì¶”ê°€</button>
      </div>

      <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
      <div class="pagination" id="pagination" style="display: none;">
        <button id="prevBtn" class="btn-secondary" disabled>ì´ì „</button>
        <span id="pageInfo">í˜ì´ì§€ 1 / 1</span>
        <button id="nextBtn" class="btn-secondary" disabled>ë‹¤ìŒ</button>
      </div>
    </div>
  </main>

  <!-- ì¬ê³  ì¶”ê°€ ëª¨ë‹¬ -->
  <div class="modal" id="addStockModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>ì¬ê³  ì¶”ê°€</h3>
        <button class="modal-close" id="closeAddStockModal">&times;</button>
      </div>
      
      <form id="addStockForm" class="product-form">
        <!-- ìƒí’ˆ ì„ íƒ -->
        <div class="form-group">
          <label for="addStockProductId">ìƒí’ˆ *</label>
          <select id="addStockProductId" name="product_id" required>
            <option value="">ìƒí’ˆì„ ì„ íƒí•˜ì„¸ìš”</option>
          </select>
        </div>

        <!-- ì‚¬ì´ì¦ˆ ì„ íƒ (ì„ íƒ ì‚¬í•­) -->
        <div class="form-group">
          <label for="addStockSize">ì‚¬ì´ì¦ˆ</label>
          <select id="addStockSize" name="size">
            <option value="">ì‚¬ì´ì¦ˆ ì„ íƒ (ì„ íƒ ì‚¬í•­)</option>
            <option value="S">S</option>
            <option value="M">M</option>
            <option value="L">L</option>
            <option value="XL">XL</option>
            <option value="XXL">XXL</option>
            <option value="F">F (Free)</option>
          </select>
          <small style="display: block; margin-top: 0.5rem; color: #6c757d;">
            ì‚¬ì´ì¦ˆë¥¼ ì…ë ¥í•˜ì§€ ì•Šìœ¼ë©´ serial_numberì—ì„œ ìë™ìœ¼ë¡œ íŒŒì‹±ë©ë‹ˆë‹¤. ì•¡ì„¸ì„œë¦¬/íƒ€ì´ë¥˜ëŠ” ë¹„ì›Œë‘ì„¸ìš”.
          </small>
        </div>

        <!-- ìƒ‰ìƒ ì„ íƒ (ì„ íƒ ì‚¬í•­) -->
        <div class="form-group">
          <label for="addStockColor">ìƒ‰ìƒ</label>
          <select id="addStockColor" name="color">
            <option value="">ìƒ‰ìƒ ì„ íƒ (ì„ íƒ ì‚¬í•­)</option>
            <option value="Black">Black</option>
            <option value="Navy">Navy</option>
            <option value="White">White</option>
            <option value="Grey">Grey</option>
            <option value="Light Blue">Light Blue</option>
            <option value="Light Grey">Light Grey</option>
          </select>
          <small style="display: block; margin-top: 0.5rem; color: #6c757d;">
            ìƒ‰ìƒì„ ì…ë ¥í•˜ì§€ ì•Šìœ¼ë©´ serial_numberì—ì„œ ìë™ìœ¼ë¡œ íŒŒì‹±ë©ë‹ˆë‹¤.
          </small>
        </div>

        <!-- í† í° ì„ íƒ -->
        <div class="form-group">
          <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 0.5rem;">
            <label style="margin-bottom: 0;">ì‚¬ìš© ê°€ëŠ¥í•œ í† í° *</label>
            <button type="button" class="btn-secondary" id="selectAllTokensBtn" style="display: none; font-size: 0.875rem; padding: 0.35rem 0.75rem;">ì „ì²´ ì„ íƒ</button>
          </div>
          <div id="tokenListContainer" style="display: none;">
            <div class="token-list" id="tokenList">
              <!-- í† í° ëª©ë¡ì´ JavaScriptë¡œ ë™ì  ìƒì„±ë¨ -->
            </div>
            <small style="display: block; margin-top: 0.5rem; color: #6c757d;">
              ìµœì†Œ 1ê°œ ì´ìƒì˜ í† í°ì„ ì„ íƒí•˜ì„¸ìš”
            </small>
          </div>
          <div id="tokenListLoading" style="display: none;">
            <p>í† í° ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
          </div>
          <div id="tokenListEmpty" style="display: none;">
            <p style="color: #6c757d;">ì‚¬ìš© ê°€ëŠ¥í•œ í† í°ì´ ì—†ìŠµë‹ˆë‹¤.</p>
            <p style="margin-top: 0.5rem;"><a href="tokens.html" class="btn-secondary" style="display: inline-block;">í† í° ê´€ë¦¬ì—ì„œ í† í° ìƒì„±</a></p>
          </div>
        </div>

        <!-- ë²„íŠ¼ -->
        <div class="form-actions">
          <button type="button" class="btn-secondary" id="cancelAddStockBtn">ì·¨ì†Œ</button>
          <button type="submit" class="btn-primary" id="submitAddStockBtn" disabled>ì¶”ê°€</button>
        </div>
      </form>
    </div>
  </div>

  <!-- ì¬ê³  ìƒì„¸ ëª¨ë‹¬ -->
  <div class="modal" id="stockDetailModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>ì¬ê³  ìƒì„¸</h3>
        <button class="modal-close" id="closeStockDetailModal">&times;</button>
      </div>
      
      <div id="stockDetailContent">
        <!-- ì¬ê³  ìƒì„¸ ì •ë³´ê°€ JavaScriptë¡œ ë™ì  ìƒì„±ë¨ -->
      </div>
    </div>
  </div>

  <!-- ê³µí†µ ë ˆì´ì•„ì›ƒ ìŠ¤í¬ë¦½íŠ¸ (í—¤ë”/ë„¤ë¹„ê²Œì´ì…˜) -->
  <script src="admin-layout.js"></script>
  <!-- í˜ì´ì§€ë³„ ìŠ¤í¬ë¦½íŠ¸ -->
  <script src="admin-stock.js"></script>
  <script>
    // ê³µí†µ ë ˆì´ì•„ì›ƒ ì´ˆê¸°í™” (ê¶Œí•œ ì²´í¬ + í—¤ë” ë Œë”ë§)
    document.addEventListener('DOMContentLoaded', async () => {
      const ok = await initAdminLayout('stock');
      if (!ok) return;
      
      // ë„¤ì„ìŠ¤í˜ì´ìŠ¤ íŒ¨í„´ìœ¼ë¡œ í˜ì´ì§€ë³„ init í˜¸ì¶œ
      const fn = window.AdminPages?.stock?.init;
      if (typeof fn === 'function') fn();
    });
  </script>
</body>
</html>
