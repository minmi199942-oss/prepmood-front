# 회원가입 페이지 구조 설계

## 📋 페이지 구성 (한 페이지 통합)

### 1. 이메일 인증 필드 (최상단)

**동작**:
- 이메일 입력
- **DB에 이미 회원가입한 이메일이면** → 로그인 페이지로 자동 이동
- **없으면** → 현재처럼 이메일 인증 진행 (인증 코드 발송 → 인증 코드 입력)

**필드**:
- 이메일 입력 필드
- "인증 코드 발송" 버튼
- 인증 코드 입력 필드 (인증 코드 발송 후 표시)

### 2. 입력 필드들 (이메일 인증 완료 후 활성화)

**필수 필드**:
1. **비밀번호** (필수)
2. **비밀번호 확인** (필수) - 유지
3. **이름** (필수) - 단일 필드 (성/이름 분리 아님)
4. **전화번호** (필수)
5. **개인정보 수집 및 이용 동의** 체크박스 (필수)
6. **이용약관에 동의합니다** 체크박스 (필수)
7. **개인정보 처리 방침에 동의합니다** 체크박스 (필수)

**선택 필드**:
7. **마케팅 정보 수신 동의** 체크박스 (선택) - ⚠️ **체크 여부 기록 필요**

## 📊 현재 구조 vs 변경 후 구조

### 현재 구조 (2단계)
1. **1단계**: 이메일 인증
   - 이메일 입력
   - 인증 코드 발송
   - 인증 코드 입력
   - "다음 단계" 버튼

2. **2단계**: 개인정보 입력
   - 성/이름 (분리)
   - 생년월일
   - 전화번호 (선택)
   - 비밀번호
   - 비밀번호 확인
   - 개인정보 수집 및 이용 동의 (필수)
   - 마케팅 정보 수신 동의 (선택)

### 변경 후 구조 (1페이지)
- **이메일 인증** (최상단)
  - 이메일 입력 → DB 확인 → 있으면 로그인 페이지 이동 / 없으면 인증 진행
- **입력 필드들** (이메일 인증 완료 후 활성화)
  - 비밀번호
  - 이름 (단일 필드)
  - 전화번호
  - 개인정보 수집 및 이용 동의 (필수)
  - 마케팅 정보 수신 동의 (선택) - **체크 여부 기록**
  - 이용약관에 동의합니다 (필수)
  - 개인정보 처리 방침에 동의합니다 (필수)

## 🔍 제거되는 필드

- **생년월일** - 제거됨 ✅
- **성/이름 분리** - 이름 단일 필드로 통합

## ✅ 유지되는 필드

- **비밀번호 확인** - 유지 ✅

## 📝 DB 변경 필요 사항

### users 테이블 확인/추가 필요 컬럼

#### 현재 users 테이블 구조 (추정)
```sql
- user_id (PK) -- ⚠️ VARCHAR(20)로 변경 예정
- email
- password_hash
- last_name (성) -- ⚠️ 제거 예정 (name으로 통합)
- first_name (이름) -- ⚠️ 제거 예정 (name으로 통합)
- birth (생년월일) -- ⚠️ 제거 예정
- phone (전화번호) -- ⚠️ 필수로 변경 (현재 선택인지 확인 필요)
- verified
- google_id
- profile_picture
- email_verified
-- ❌ 동의 관련 컬럼 없음 (추가 필요)
-- ❌ name 컬럼 없음 (추가 필요)
```

#### 추가/변경 필요 사항

1. **이름 필드 통합** ✅
   - **확정**: `name` 단일 컬럼으로 변경, `last_name`, `first_name` 제거
   - 기존 데이터 마이그레이션: `last_name + ' ' + first_name` → `name`

2. **생년월일 필드 제거** ✅
   - `birth` 컬럼 제거 또는 NULL 허용으로 변경
   - 기존 데이터는 NULL로 설정

3. **전화번호 필수 변경** ✅
   - `phone` 컬럼이 현재 NULL 허용인지 확인
   - NULL 허용이면 `NOT NULL`로 변경 (또는 기본값 설정)

4. **마케팅 정보 수신 동의** (⚠️ 중요) ✅
   - `marketing_consent` 컬럼 추가 필요
   - 타입: `TINYINT(1)` 또는 `BOOLEAN`
   - 기본값: `0` (FALSE)
   - **체크 여부 기록 필수** (선택이지만 기록 필요)

5. **이용약관 동의** ✅
   - `terms_consent` 컬럼 추가 필요
   - 타입: `TINYINT(1)` 또는 `BOOLEAN`
   - 기본값: `0` (FALSE)
   - 필수 동의

6. **개인정보 처리 방침 동의** ✅
   - `privacy_policy_consent` 컬럼 추가 필요
   - 타입: `TINYINT(1)` 또는 `BOOLEAN`
   - 기본값: `0` (FALSE)
   - 필수 동의

7. **개인정보 수집 및 이용 동의** ✅
   - `privacy_consent` 컬럼 추가 필요 (기존에 없음)
   - 타입: `TINYINT(1)` 또는 `BOOLEAN`
   - 기본값: `0` (FALSE)
   - 필수 동의

## 🔄 회원가입 API 변경 사항

### 현재 API 요청 데이터
```javascript
{
  email: string,
  password: string,
  name: string,  // "성 이름" 형식
  birthdate: string,  // ISO8601
  phone: string | null
}
```

### 변경 후 API 요청 데이터
```javascript
{
  email: string,
  password: string,
  confirmPassword: string,  // 비밀번호 확인 (유지)
  name: string,  // 단일 필드
  phone: string,  // 필수
  privacy_consent: boolean,  // 개인정보 수집 및 이용 동의 (필수)
  marketing_consent: boolean,  // 마케팅 정보 수신 동의 (선택, 체크 여부 기록 필수)
  terms_consent: boolean,  // 이용약관 동의 (필수)
  privacy_policy_consent: boolean  // 개인정보 처리 방침 동의 (필수)
}
```

### 백엔드 처리 로직

1. **이메일 중복 확인** (이미 있음)
   - DB에 이미 회원가입한 이메일이면 → 로그인 페이지로 리다이렉트 안내
   - 없으면 → 회원가입 진행

2. **user_id 생성** (users 테이블 마이그레이션 후)
   - `generateUniqueUserId()` 함수 사용
   - 형식: `PM.{년도}.{랜덤6자}`

3. **이름 처리**
   - `name` 필드를 받아서 `last_name`, `first_name`으로 분리 저장
   - 또는 `name` 단일 컬럼으로 저장 (DB 변경 시)

4. **동의 정보 저장**
   - `marketing_consent`: 체크 여부 기록 (선택이지만 기록 필수)
   - `terms_consent`: 필수 동의
   - `privacy_policy_consent`: 필수 동의
   - `privacy_consent`: 필수 동의 (기존 또는 새로 추가)

## ✅ 확인 완료 사항

1. **전화번호**: 필수 ✅
2. **생년월일**: 제거 ✅
3. **비밀번호 확인**: 유지 ✅
4. **기존 users 테이블에 동의 관련 컬럼**: 없음 ✅

## 📝 다음 단계

1. **현재 users 테이블 구조 확인** ✅
   - 동의 관련 컬럼: 없음 (추가 필요)
   - 생년월일 필드: 제거 예정
   - 전화번호: 필수로 변경 필요

2. **users 테이블 마이그레이션 계획 수정**
   - 동의 관련 컬럼 4개 추가:
     - `privacy_consent` (개인정보 수집 및 이용 동의, 필수)
     - `marketing_consent` (마케팅 정보 수신 동의, 선택, 체크 여부 기록)
     - `terms_consent` (이용약관 동의, 필수)
     - `privacy_policy_consent` (개인정보 처리 방침 동의, 필수)
   - `birth` 컬럼 제거 또는 NULL 허용
   - `phone` 컬럼 필수로 변경
   - 이름 필드 처리 방식 결정 (옵션 B 권장)

3. **회원가입 API 수정**
   - 이메일 중복 시 로그인 페이지 이동 로직
   - 동의 정보 저장 로직 (4개 컬럼)
   - user_id 생성 로직 (마이그레이션 후)
   - 생년월일 제거
   - 전화번호 필수 검증

4. **회원가입 페이지 구현**
   - 한 페이지 구조로 변경
   - 이메일 인증 + 모든 필드 통합
   - 비밀번호 확인 필드 유지

