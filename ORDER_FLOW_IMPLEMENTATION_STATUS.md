# μ£Όλ¬Έ νλ¦„ κµ¬ν„ ν„ν™© μ κ²€ (ν™λ¶/μ–‘λ„ μ μ™Έ)

## π“‹ μ κ²€ κΈ°μ¤€: μ‚¬μ©μκ°€ μ •λ¦¬ν• νλ¦„

### λΉ„νμ› μ£Όλ¬Έ νλ¦„

#### 1. guest_idκ°€ μ£Όλ¬Έλ³„λ΅ μƒμ„±
- β… **κµ¬ν„ μ™„λ£**: `processPaidOrder()`μ—μ„ `guest_id` μƒμ„± λ° `guest_order_access_tokens` μƒμ„±
- β… **μ„μΉ**: `backend/utils/paid-order-processor.js` (600-636μ¤„)
- β… **ν…μ΄λΈ”**: `guest_order_access_tokens` ν…μ΄λΈ” μƒμ„±λ¨

#### 2. μ΄λ©”μΌλ΅ λ””μ§€ν„Έ μΈλ³΄μ΄μ¤ λ°κΈ‰ (λ§ν¬ ν¬ν•¨)
- β **λ―Έκµ¬ν„**: μΈλ³΄μ΄μ¤ μ΄λ©”μΌ λ°μ†΅ λ΅μ§ μ—†μ
- β οΈ **ν„μ¬ μƒνƒ**: 
  - `invoices.emailed_at` μ»¬λΌμ€ μμ§€λ§ λ°μ†΅ λ΅μ§ μ—†μ
  - `mailer.js`μ— `sendInvoiceEmail` ν•¨μ μ—†μ
  - μ£Όλ¬Έ ν™•μΈ μ΄λ©”μΌ(`sendOrderConfirmationEmail`)λ§ μμ
- π“ **ν•„μ” μ‘μ—…**: μΈλ³΄μ΄μ¤ μ΄λ©”μΌ λ°μ†΅ ν•¨μ μ¶”κ°€ λ° `processPaidOrder()` ν›„ νΈμ¶

#### 3. λ§ν¬ ν΄λ¦­ μ‹ μ •λ³΄ ν‘μ‹
- β… **κµ¬ν„ μ™„λ£**: `guest/orders.html` + `guest/orders.js`
- β… **ν‘μ‹ μ •λ³΄**:
  - β… μ£Όλ¬Έμ •λ³΄: μ£Όλ¬Έλ²νΈ, μ£Όλ¬ΈμΌμ‹, μ£Όλ¬Έ μƒνƒ, μ΄ μ£Όλ¬Έ κΈμ•΅
  - β… μ£Όλ¬Έ μƒνƒ: κ²°μ  μ™„λ£/λ°°μ†΅μ¤‘/μ™„λ£ λ“± (`order.status`)
  - β… μƒν’μ •λ³΄: μƒν’λ…, μµμ…(μƒ‰μƒ/μ‚¬μ΄μ¦), μλ‰, κ°€κ²©
  - β… κ²°μ  μ •λ³΄: κ²°μ  λ°©λ²•, κ²°μ  κΈμ•΅, κ²°μ μΌμ‹, κ²°μ  μƒνƒ
  - β… λ°°μ†΅μ •λ³΄: λ°°μ†΅μ§€ μ •λ³΄, λ°°μ†΅ μƒνƒ, μ†΅μ¥λ²νΈ, νƒλ°°μ‚¬ μ •λ³΄
  - β… μ •μ±… λ§ν¬: μ΄μ©μ•½κ΄€, κ°μΈμ •λ³΄μ²λ¦¬λ°©μΉ¨ λ§ν¬

#### 4. QR μ¤μΊ” (λ΅κ·ΈμΈ ν•„μ) β†’ λ””μ§€ν„Έ λ³΄μ¦μ„ ν™μ„±ν™”
- β… **QR μ¤μΊ”**: `GET /api/warranties/:publicId` (warranty-event-routes.js)
- β… **ν™μ„±ν™” API**: `POST /api/warranties/:warrantyId/activate` (warranty-routes.js)
- β οΈ **κ²½κ³  λ¬Έκµ¬**: 
  - β **λ―Έν™μ„± μƒνƒ κ²½κ³  λ¬Έκµ¬ μ—†μ**: "λ³΄μ¦μ„ λ―Έν™μ„± μƒνƒμ—μ„λ§ μ „μμƒκ±°λλ²•μ— λ”°λ¥Έ μ²­μ•½μ² νκ°€ κ°€λ¥ν•©λ‹λ‹¤."
  - β **ν™μ„±ν™” μ‹ κ²½κ³  λ¬Έκµ¬ μ—†μ**: "λ³΄μ¦μ„λ¥Ό ν™μ„±ν™”ν•λ©΄ ν•΄λ‹Ή μƒν’μ€ μ‚¬μ© κ°μ‹λ΅ κ°„μ£Όλμ–΄ μƒ μƒν’μΌλ΅ μ¬νλ§¤κ°€ λ¶κ°€λ¥ν•©λ‹λ‹¤. μ΄μ— λ”°λΌ κµν™ λ° ν™λ¶μ΄ μ ν•λ©λ‹λ‹¤."
  - β οΈ **ν„μ¬**: `my-warranties.js`μ— κ°„λ‹¨ν• `confirm()` λ©”μ‹μ§€λ§ μμ
    ```javascript
    const agreeText = `λ³΄μ¦μ„λ¥Ό ν™μ„±ν™”ν•μ‹κ² μµλ‹κΉ?\n\nν™μ„±ν™”λ λ³΄μ¦μ„λ” μ–‘λ„ λ° ν™λ¶ μ •μ±…μ΄ μ μ©λ©λ‹λ‹¤.`;
    ```

#### 5. λ””μ§€ν„Έ μΈλ³΄μ΄μ¤λ” μ΄λ©”μΌμ—μ„ λ³„λ„ μ—°λ™ κΈ°λ¥
- β… **κµ¬ν„ μ™„λ£**: Claim API κµ¬ν„λ¨
- β… **API μ—”λ“ν¬μΈνΈ**:
  - `POST /api/orders/:orderId/claim-token` - Claim token λ°κΈ‰
  - `POST /api/orders/:orderId/claim` - Claim μ‹¤ν–‰
- β… **ν”„λ΅ νΈμ—”λ“**: `guest/orders.html`μ— "λ‚΄ κ³„μ •μ— μ—°λ™ν•κΈ°" λ²„νΌ μμ
- β… **μ²λ¦¬ νλ¦„**: 
  - λΉ„νμ› μ£Όλ¬Έ μ΅°ν β†’ λ΅κ·ΈμΈ β†’ Claim token λ°κΈ‰ β†’ Claim μ‹¤ν–‰
  - `warranties.status`: `issued_unassigned` β†’ `issued`
  - `warranties.owner_user_id`: NULL β†’ `user_id`

---

### νμ› μ£Όλ¬Έ νλ¦„

#### 1. user_idμ™€ ν•¨κ» μ£Όλ¬Έ λ°μ΄ν„° μ €μ¥
- β… **κµ¬ν„ μ™„λ£**: `POST /api/orders`μ—μ„ `user_id` μ €μ¥
- β… **μ„μΉ**: `backend/order-routes.js`

#### 2. μ΄λ©”μΌλ΅ μ£Όλ¬Έμ„ λ°μ†΅ (λΉ„νμ›κ³Ό λ™μΌ μ •λ³΄)
- β… **κµ¬ν„ μ™„λ£**: `sendOrderConfirmationEmail` νΈμ¶
- β… **μ„μΉ**: `backend/payments-routes.js` (692-714μ¤„)
- β… **μ΄λ©”μΌ λ‚΄μ©**: μ£Όλ¬Έλ²νΈ, μ£Όλ¬Έ μƒμ„Έ μ •λ³΄, μ£Όλ¬Έ λ§ν¬ λ“±

#### 3. μλ™μΌλ΅ λ””μ§€ν„Έ μΈλ³΄μ΄μ¤μ™€ λ””μ§€ν„Έ λ³΄μ¦μ„κ°€ κ³„μ •μ— κ·€μ†
- β… **μΈλ³΄μ΄μ¤**: `processPaidOrder()` β†’ `createInvoiceFromOrder()` μλ™ μƒμ„±
- β… **λ³΄μ¦μ„**: `processPaidOrder()`μ—μ„ μλ™ μƒμ„± (`warranties.status = 'issued'`, `owner_user_id = user_id`)
- β… **λ§μ΄νμ΄μ§€ ν‘μ‹**:
  - β… λ””μ§€ν„Έ μΈλ³΄μ΄μ¤: `digital-invoice.html` + `GET /api/invoices/me`
  - β… λ””μ§€ν„Έ λ³΄μ¦μ„: `my-warranties.html` + `GET /api/warranties/me`

#### 4. λ””μ§€ν„Έ λ³΄μ¦μ„ ν™μ„±ν™” μ „ κ²½κ³  λ¬Έκµ¬
- β **λ―Έκµ¬ν„**: "λ³΄μ¦μ„ λ―Έν™μ„± μƒνƒμ—μ„λ§ μ „μμƒκ±°λλ²•μ— λ”°λ¥Έ μ²­μ•½μ² νκ°€ κ°€λ¥ν•©λ‹λ‹¤." λ¬Έκµ¬ μ—†μ
- β οΈ **ν„μ¬**: `my-warranties.js`μ— κ°„λ‹¨ν• `confirm()` λ©”μ‹μ§€λ§ μμ
- π“ **ν•„μ” μ‘μ—…**: 
  - `my-warranties.html`μ— κ²½κ³  λ¬Έκµ¬ μ¶”κ°€
  - ν™μ„±ν™” λ²„νΌ ν΄λ¦­ μ‹ λ¨λ‹¬/κ²½κ³  ν‘μ‹

#### 5. ν™μ„±ν™” μ‹ κ²½κ³  λ¬Έκµ¬
- β **λ―Έκµ¬ν„**: "λ³΄μ¦μ„λ¥Ό ν™μ„±ν™”ν•λ©΄ ν•΄λ‹Ή μƒν’μ€ μ‚¬μ© κ°μ‹λ΅ κ°„μ£Όλμ–΄ μƒ μƒν’μΌλ΅ μ¬νλ§¤κ°€ λ¶κ°€λ¥ν•©λ‹λ‹¤. μ΄μ— λ”°λΌ κµν™ λ° ν™λ¶μ΄ μ ν•λ©λ‹λ‹¤." λ¬Έκµ¬ μ—†μ
- β οΈ **ν„μ¬**: `my-warranties.js`μ— κ°„λ‹¨ν• `confirm()` λ©”μ‹μ§€λ§ μμ
- π“ **ν•„μ” μ‘μ—…**: 
  - ν™μ„±ν™” ν™•μΈ λ¨λ‹¬μ— μƒμ„Έ κ²½κ³  λ¬Έκµ¬ μ¶”κ°€
  - λ™μ μ²΄ν¬λ°•μ¤ μ¶”κ°€

---

## π“ κµ¬ν„ ν„ν™© μ”μ•½

### β… κµ¬ν„ μ™„λ£ (80%)

1. β… **λΉ„νμ› μ£Όλ¬Έ**: guest_id μƒμ„±, guest_order_access_tokens μƒμ„±
2. β… **λΉ„νμ› μ£Όλ¬Έ μ΅°ν**: `guest/orders.html/js` - μ£Όλ¬Έμ •λ³΄, μ£Όλ¬Έ μƒνƒ, μƒν’μ •λ³΄, κ²°μ  μ •λ³΄, λ°°μ†΅μ •λ³΄, μ •μ±… λ§ν¬ λ¨λ‘ ν‘μ‹
3. β… **Claim κΈ°λ¥**: λΉ„νμ› μ£Όλ¬Έ β†’ νμ› κ³„μ • μ—°λ™ API κµ¬ν„ μ™„λ£
4. β… **νμ› μ£Όλ¬Έ**: user_id μ €μ¥, μ΄λ©”μΌ λ°μ†΅, μΈλ³΄μ΄μ¤/λ³΄μ¦μ„ μλ™ κ·€μ†
5. β… **λ³΄μ¦μ„ ν™μ„±ν™” API**: `POST /api/warranties/:warrantyId/activate` κµ¬ν„ μ™„λ£
6. β… **QR μ¤μΊ”**: λ³΄μ¦μ„ μ΅°ν API κµ¬ν„ μ™„λ£

### β λ―Έκµ¬ν„ (20%)

1. β **μΈλ³΄μ΄μ¤ μ΄λ©”μΌ λ°μ†΅**: 
   - μΈλ³΄μ΄μ¤ μƒμ„± ν›„ μ΄λ©”μΌ λ°μ†΅ λ΅μ§ μ—†μ
   - `sendInvoiceEmail` ν•¨μ μ¶”κ°€ ν•„μ”

2. β **λ³΄μ¦μ„ ν™μ„±ν™” κ²½κ³  λ¬Έκµ¬**:
   - λ―Έν™μ„± μƒνƒ κ²½κ³ : "λ³΄μ¦μ„ λ―Έν™μ„± μƒνƒμ—μ„λ§ μ „μμƒκ±°λλ²•μ— λ”°λ¥Έ μ²­μ•½μ² νκ°€ κ°€λ¥ν•©λ‹λ‹¤."
   - ν™μ„±ν™” μ‹ κ²½κ³ : "λ³΄μ¦μ„λ¥Ό ν™μ„±ν™”ν•λ©΄ ν•΄λ‹Ή μƒν’μ€ μ‚¬μ© κ°μ‹λ΅ κ°„μ£Όλμ–΄ μƒ μƒν’μΌλ΅ μ¬νλ§¤κ°€ λ¶κ°€λ¥ν•©λ‹λ‹¤. μ΄μ— λ”°λΌ κµν™ λ° ν™λ¶μ΄ μ ν•λ©λ‹λ‹¤."
   - ν„μ¬λ” κ°„λ‹¨ν• `confirm()` λ©”μ‹μ§€λ§ μμ

3. β **λΉ„νμ› μΈλ³΄μ΄μ¤ μ΅°ν**: 
   - λΉ„νμ›μ€ μΈλ³΄μ΄μ¤λ¥Ό μ΅°νν•  μ μ—†μ (νμ› μ „μ©)

---

## π“ μ°μ„ μμ„λ³„ κ°μ„  μ‚¬ν•­

### μ°μ„ μμ„ 1: λ³΄μ¦μ„ ν™μ„±ν™” κ²½κ³  λ¬Έκµ¬ μ¶”κ°€
**μ„μΉ**: `my-warranties.html`, `my-warranties.js`

**ν•„μ” μ‘μ—…**:
1. ν™μ„±ν™” λ²„νΌ ν΄λ¦­ μ‹ λ¨λ‹¬ ν‘μ‹
2. λ¨λ‹¬μ— κ²½κ³  λ¬Έκµ¬ μ¶”κ°€:
   - λ―Έν™μ„± μƒνƒ: "λ³΄μ¦μ„ λ―Έν™μ„± μƒνƒμ—μ„λ§ μ „μμƒκ±°λλ²•μ— λ”°λ¥Έ μ²­μ•½μ² νκ°€ κ°€λ¥ν•©λ‹λ‹¤."
   - ν™μ„±ν™” μ‹: "λ³΄μ¦μ„λ¥Ό ν™μ„±ν™”ν•λ©΄ ν•΄λ‹Ή μƒν’μ€ μ‚¬μ© κ°μ‹λ΅ κ°„μ£Όλμ–΄ μƒ μƒν’μΌλ΅ μ¬νλ§¤κ°€ λ¶κ°€λ¥ν•©λ‹λ‹¤. μ΄μ— λ”°λΌ κµν™ λ° ν™λ¶μ΄ μ ν•λ©λ‹λ‹¤."
3. λ™μ μ²΄ν¬λ°•μ¤ μ¶”κ°€

### μ°μ„ μμ„ 2: μΈλ³΄μ΄μ¤ μ΄λ©”μΌ λ°μ†΅
**μ„μΉ**: `backend/mailer.js`, `backend/utils/paid-order-processor.js`

**ν•„μ” μ‘μ—…**:
1. `sendInvoiceEmail` ν•¨μ μ¶”κ°€
2. `processPaidOrder()` ν›„ μ΄λ©”μΌ λ°μ†΅ νΈμ¶
3. νμ›/λΉ„νμ› κµ¬λ¶„ν•μ—¬ μ΄λ©”μΌ λ°μ†΅

### μ°μ„ μμ„ 3: λΉ„νμ› μΈλ³΄μ΄μ¤ μ΅°ν
**μ„μΉ**: `backend/invoice-routes.js`

**ν•„μ” μ‘μ—…**:
1. `GET /api/guest/invoices/:invoiceId` API μ¶”κ°€
2. `GET /api/guest/invoices` API μ¶”κ°€ (λ©λ΅ μ΅°ν)

---

## β… μ „μ²΄ ν‰κ°€

**κµ¬ν„ μ™„λ£**: 80%
- ν•µμ‹¬ νλ¦„ (μ£Όλ¬Έ μƒμ„±, κ²°μ , μΈλ³΄μ΄μ¤/λ³΄μ¦μ„ μƒμ„±, μ΅°ν) λ¨λ‘ κµ¬ν„ μ™„λ£
- λΉ„νμ› μ£Όλ¬Έ μ΅°ν νμ΄μ§€ μ™„μ„±
- Claim κΈ°λ¥ κµ¬ν„ μ™„λ£

**λ―Έκµ¬ν„**: 20%
- μΈλ³΄μ΄μ¤ μ΄λ©”μΌ λ°μ†΅
- λ³΄μ¦μ„ ν™μ„±ν™” κ²½κ³  λ¬Έκµ¬ (μƒμ„Έ λ¬Έκµ¬)
- λΉ„νμ› μΈλ³΄μ΄μ¤ μ΅°ν
